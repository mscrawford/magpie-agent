# MAgPIE Agent - Complete Documentation Ecosystem Map

**Purpose**: Comprehensive inventory of ALL documentation, their roles, and inconsistency risks.

**Last Updated**: 2025-10-26

---

## üìä COMPLETE INVENTORY (ALL 82+ FILES)

```
CATEGORY                        FILES    ~LINES    ROLE
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

üéØ META-PROJECT (Documentation Project Itself)
‚îú‚îÄ START_HERE.md                  1        250    NEW SESSION ENTRY POINT
‚îú‚îÄ RULES_OF_THE_ROAD.md           1        300    Session continuity protocol
‚îú‚îÄ README.md                      1        250    Project overview (GitHub)
‚îú‚îÄ CURRENT_STATE.json             1        209    SINGLE SOURCE OF TRUTH (status)
‚îî‚îÄ DIRECTORY_AUDIT_REPORT.md      1        ???    Audit report (reference)

ü§ñ PRIMARY AGENT INSTRUCTIONS
‚îú‚îÄ CLAUDE.md                      1        974    AGENT SYSTEM PROMPT (always loaded)
‚îî‚îÄ AI_Agent_Behavior_Guide.md     1        994    Query routing & response patterns

üèóÔ∏è CORE ARCHITECTURE REFERENCE
‚îú‚îÄ Phase1_Core_Architecture       1        366    Model structure, execution flow
‚îú‚îÄ Phase2_Module_Dependencies     1        415    173 dependencies, centrality
‚îú‚îÄ Phase3_Data_Flow               1        460    172 input files, data pipeline
‚îî‚îÄ Tool_Usage_Patterns            1        716    Bash/Read/Write best practices

üì¶ MODULE DOCUMENTATION (Single Source of Truth)
‚îú‚îÄ module_09.md through           46    43,883    ALL MODULE DETAILS
‚îÇ  module_80.md                                   - Equations (verified)
‚îÇ                                                 - Parameters
‚îÇ                                                 - Dependencies
‚îÇ                                                 - Limitations
‚îî‚îÄ modules/README.md              1        ???    Overview (STATIC)

üí¨ MODULE NOTES (User Feedback Overlay)
‚îú‚îÄ module_10_notes.md             1        296    Warnings, lessons, examples
‚îú‚îÄ module_52_notes.md             1         82    (overlay, not replacement)
‚îú‚îÄ module_70_notes.md             1        176
‚îî‚îÄ (can grow as feedback integrated)

üîó CROSS-MODULE ANALYSIS
‚îú‚îÄ land_balance_conservation      1        820    7 land types, conservation
‚îú‚îÄ water_balance_conservation     1        972    5 sectors, 4 sources
‚îú‚îÄ carbon_balance_conservation    1        970    3 pools, Chapman-Richards
‚îú‚îÄ nitrogen_food_balance          1        331    N tracking, food balance
‚îú‚îÄ modification_safety_guide      1      1,102    Safety for Modules 10,11,17,56
‚îú‚îÄ circular_dependency_resolution 1      1,034    26 cycles, resolution mechanisms
‚îî‚îÄ cross_module/README.md         1        ???    Overview

üìò GAMS PROGRAMMING REFERENCE
‚îú‚îÄ GAMS_Phase1_Fundamentals       1      1,585    Sets, parameters, equations
‚îú‚îÄ GAMS_Phase2_Control_Structures 1      1,085    Dollar conditions, loops
‚îú‚îÄ GAMS_Phase3_Advanced_Features  1      1,297    Macros, attributes
‚îú‚îÄ GAMS_Phase4_Functions          1        898    Math, aggregation
‚îú‚îÄ GAMS_Phase5_MAgPIE_Patterns    1      1,004    Naming, module structure
‚îú‚îÄ GAMS_Phase6_Best_Practices     1        794    Debugging, performance
‚îî‚îÄ GAMS_Programming_Reference_Plan 1       959    Plan document

üîÑ FEEDBACK SYSTEM
‚îú‚îÄ feedback/README.md              1       263    System overview
‚îú‚îÄ feedback/COMPRESSION_GUIDE.md   1       ???    How to compress
‚îú‚îÄ feedback/FUTURE_ENHANCEMENTS.md 1       ???    Planned improvements
‚îú‚îÄ global/claude_lessons.md        1       241    Global behavior lessons
‚îú‚îÄ integrated/*.md                 5       ???    Archived feedback (historical)
‚îî‚îÄ templates/*.md                  5       ???    Submission templates

‚ö° SLASH COMMANDS (Operational Workflows)
‚îú‚îÄ /guide                          1       493    Complete capabilities
‚îú‚îÄ /update                         1       171    Pull latest docs
‚îú‚îÄ /feedback                       1       230    Feedback system
‚îú‚îÄ /compress-feedback              1       412    Synthesize feedback
‚îî‚îÄ /update-claude-md               1       120    Git workflow

üìö REFERENCE MATERIALS
‚îú‚îÄ Code_Truth_Principles.md        1       ???    Core principle docs
‚îú‚îÄ Verification_Protocol.md        1       ???    How to verify modules
‚îî‚îÄ AI_Instruction_Refinement_Plan  1       ???    Plan document

üì¶ ARCHIVES (Historical)
‚îî‚îÄ archive/*.md, working/*.md    ~10+      ???    Old session logs, temp files

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
TOTAL                            ~82+   ~65,000+ lines
```

---

## üéØ DOCUMENT ROLES & WHEN THEY'RE READ

### **ALWAYS READ (Every Session)**

```
CLAUDE.md (974 lines)
‚îú‚îÄ Loaded automatically by Claude Code as system prompt
‚îú‚îÄ Contains: Workflow rules, routing logic, response patterns
‚îî‚îÄ Agent reads: ALWAYS (part of system context)
```

### **PROJECT ORIENTATION (Documentation Project Work)**

```
When agent works on documentation project itself:

START_HERE.md ‚Üí CURRENT_STATE.json ‚Üí RULES_OF_THE_ROAD.md
     ‚Üì                ‚Üì                        ‚Üì
  Entry point    Status tracker         Session protocol

Agent reads: ONLY when working on documentation project
NOT read: When answering MAgPIE questions (would be noise)
```

### **QUERY-SPECIFIC LOOKUPS**

#### Simple Query: "What equation calculates X?"
```
CLAUDE.md (routing) ‚Üí modules/module_XX.md ‚Üí DONE
(2 files, ~1,000 lines)
```

#### Module Modification: "Can I change Module 10?"
```
CLAUDE.md (routing)
  ‚Üí modules/module_10.md (understand module)
  ‚Üí Phase2_Module_Dependencies.md (23 dependents!)
  ‚Üí modification_safety_guide.md (safety protocols)
  ‚Üí module_10_notes.md (user warnings)
  ‚Üí land_balance_conservation.md (conservation law)
(6 files, ~4,000 lines)
```

#### GAMS Code Work: "Write equation for Module 56"
```
CLAUDE.md (routing)
  ‚Üí reference/GAMS_Phase5_MAgPIE_Patterns.md (naming)
  ‚Üí reference/GAMS_Phase2_Control_Structures.md (syntax)
  ‚Üí modules/module_56.md (context)
(4 files, ~3,000 lines)
```

---

## ‚ö†Ô∏è INCONSISTENCY RISK ANALYSIS (UPDATED)

### üî¥ **CRITICAL RISK: Information in Multiple Places**

#### **1. Project Status/Instructions**
```
PROBLEM: Instructions scattered across 5 files

STORED IN:
‚îú‚îÄ START_HERE.md (says: "Read CURRENT_STATE.json")
‚îú‚îÄ RULES_OF_THE_ROAD.md (says: "Read CURRENT_STATE.json")
‚îú‚îÄ CLAUDE.md (says: "Read START_HERE.md if doc project")
‚îú‚îÄ README.md (says: "Read START_HERE.md")
‚îî‚îÄ CURRENT_STATE.json (actual status data)

RISK: If workflow changes, need to update 4 files
MITIGATION: All 4 explicitly declare themselves STATIC
```

#### **2. Module Dependencies**
```
STORED IN:
‚îú‚îÄ Phase2_Module_Dependencies.md (AUTHORITATIVE: dependency graph)
‚îú‚îÄ modification_safety_guide.md (Module 10: 23 dependents)
‚îú‚îÄ module_10.md (Section: Modules that depend on this)
‚îú‚îÄ module_10_notes.md (W003: "23 dependents")
‚îî‚îÄ cross_module/*_conservation.md (specific dependency chains)

RISK: Dependency count changes ‚Üí need to update 5 files
WORST CASE: Different counts in different files (user confusion)
```

#### **3. Conservation Laws**
```
STORED IN:
‚îú‚îÄ cross_module/land_balance_conservation.md (AUTHORITATIVE)
‚îú‚îÄ module_10.md (mentions q10_land_area)
‚îú‚îÄ modification_safety_guide.md (Module 10 section)
‚îú‚îÄ Phase1_Core_Architecture.md (overview mention)

RISK: Equation details change ‚Üí update 4 files
```

#### **4. Workflow Instructions**
```
STORED IN:
‚îú‚îÄ CLAUDE.md (check AI docs FIRST workflow)
‚îú‚îÄ AI_Agent_Behavior_Guide.md (detailed routing patterns)
‚îú‚îÄ START_HERE.md (project workflow)
‚îú‚îÄ RULES_OF_THE_ROAD.md (session protocol)
‚îú‚îÄ feedback/global/claude_lessons.md (behavior lessons)

RISK: Conflicting workflows if not synchronized
```

### üü° **MEDIUM RISK: Overlapping Content**

#### **5. Agent Behavior Guidance**
```
STORED IN:
‚îú‚îÄ CLAUDE.md (primary instructions)
‚îú‚îÄ AI_Agent_Behavior_Guide.md (detailed patterns)
‚îú‚îÄ RULES_OF_THE_ROAD.md (session rules - for doc project)
‚îî‚îÄ feedback/global/claude_lessons.md (learned corrections)

RISK: Contradictory guidance
CURRENT STATE: Mostly hierarchical, but growing
```

#### **6. Setup Instructions**
```
STORED IN:
‚îú‚îÄ README.md (GitHub setup instructions)
‚îú‚îÄ CLAUDE.md (bootstrap section)
‚îî‚îÄ START_HERE.md (mentions setup)

RISK: Outdated setup steps in one file
```

### üü¢ **LOW RISK: Complementary Roles**

#### **7. GAMS Reference**
```
STORED IN:
‚îú‚îÄ reference/GAMS_Phase*.md (6 files - comprehensive)
‚îú‚îÄ Phase1_Core_Architecture.md (brief naming overview)

COMPLEMENTARY: Architecture gives overview, GAMS deep dive
```

---

## üîç **SPECIFIC INCONSISTENCIES FOUND**

### **Issue 1: Conflicting Entry Points**

```
README.md says:        "Read START_HERE.md"
CLAUDE.md says:        "If doc project: Read START_HERE.md"
START_HERE.md says:    "Read CURRENT_STATE.json"
RULES_OF_THE_ROAD says: "Read START_HERE.md then CURRENT_STATE.json"

CONFUSING: Multiple paths to same info
SOLUTION: Clarify context (doc project vs. MAgPIE questions)
```

### **Issue 2: Two "Agent Behavior Guides"**

```
CLAUDE.md (974 lines):
- Primary agent instructions
- Workflow rules
- Response patterns

AI_Agent_Behavior_Guide.md (994 lines):
- Detailed query routing
- Response patterns
- Token efficiency

OVERLAP: Both have response patterns, workflow guidance
RISK: Conflicting advice
```

### **Issue 3: Multiple "Status" Declarations**

```
START_HERE.md: "‚ö†Ô∏è FOR CURRENT PROJECT STATUS: See CURRENT_STATE.json ‚ö†Ô∏è"
README.md:     "‚ö†Ô∏è FOR CURRENT STATUS: See CURRENT_STATE.json ‚ö†Ô∏è"
RULES_OF_THE_ROAD: "‚ö†Ô∏è THIS IS A STATIC REFERENCE DOCUMENT ‚ö†Ô∏è"
CLAUDE.md:     "CURRENT_STATE.json is the ONLY file tracking project status"

REDUNDANT: Same warning in 4 places
RESULT: Low risk (all point to same place, but verbose)
```

---

## üí° **CONCRETE RECOMMENDATIONS**

### **Option 1: Document Role Hierarchy (Add to CLAUDE.md)**

```markdown
## üìê DOCUMENT ROLES & PRECEDENCE

### When Answering MAgPIE Questions:
1. CLAUDE.md ‚Üí routing logic
2. modules/module_XX.md ‚Üí facts (SINGLE SOURCE OF TRUTH)
3. cross_module/*.md ‚Üí system analysis
4. Phase*.md ‚Üí architecture reference
5. module_XX_notes.md ‚Üí warnings/lessons (may be outdated)

### When Working on Documentation Project:
1. START_HERE.md ‚Üí entry point
2. CURRENT_STATE.json ‚Üí status (SINGLE SOURCE OF TRUTH)
3. RULES_OF_THE_ROAD.md ‚Üí protocol
4. CLAUDE.md ‚Üí agent instructions

### If Information Conflicts:
Priority order:
1. Code itself (../modules/XX_name/realization/*.gms)
2. module_XX.md (verified against code)
3. cross_module/*.md (derived from modules)
4. Phase*.md (overview only)
5. notes files (user experience, may lag)

Action: Create feedback about the conflict
```

### **Option 2: Consolidate Overlapping Files**

**Candidate for Merger:**
```
AI_Agent_Behavior_Guide.md (994 lines)
                 ‚Üì
        Merge into CLAUDE.md?
                 ‚Üì
   Or: Keep separate but clarify roles:
   - CLAUDE.md = Quick reference (routing, workflows)
   - AI_Agent_Behavior_Guide.md = Deep dive (detailed patterns)
```

**Candidate for Simplification:**
```
START_HERE.md + README.md + RULES_OF_THE_ROAD
                 ‚Üì
All say: "Read CURRENT_STATE.json"
                 ‚Üì
Simplify to: README ‚Üí START_HERE ‚Üí CURRENT_STATE
```

### **Option 3: Create Consistency Validation Script**

```bash
#!/bin/bash
# scripts/validate_consistency.sh

echo "=== Documentation Consistency Check ==="

# Check 1: Dependency count consistency
echo "Checking Module 10 dependent count..."
grep -r "23 dependents" magpie-agent/ 2>/dev/null
# Should appear in: Phase2, module_10.md, module_10_notes, safety_guide

# Check 2: Chapman-Richards parameter count
echo "Checking Chapman-Richards parameters..."
grep -r "3 parameters\|3-parameter" magpie-agent/ 2>/dev/null
# Should be consistent across module_52.md, carbon_balance, notes

# Check 3: Entry point instructions
echo "Checking entry point consistency..."
grep -r "START_HERE.md\|CURRENT_STATE" README.md START_HERE.md RULES_OF_THE_ROAD.md

# Check 4: Cross-references
echo "Checking broken cross-references..."
# Extract all "see module_XX.md" references, verify files exist

# Check 5: Equation duplicates
echo "Checking for duplicate equation definitions..."
# Flag if same equation appears with different formulas
```

---

## üéØ **IMMEDIATE ACTION ITEMS**

### **Priority 1: Clarify Document Roles**

**Add to CLAUDE.md:**
- Document hierarchy section
- Precedence rules for conflicts
- Clear separation: "Doc project work" vs. "MAgPIE questions"

### **Priority 2: Reduce Entry Point Confusion**

**Simplify:**
```
README.md: "Using MAgPIE with Claude? The agent reads CLAUDE.md automatically."
START_HERE.md: "Working on documentation project? Read CURRENT_STATE.json"
```

### **Priority 3: Flag High-Risk Duplicates**

**Create markers:**
```markdown
## Module Dependencies (‚ö†Ô∏è SYNC WITH Phase2_Module_Dependencies.md)

Module 10 has **23 dependents** (last updated: 2025-10-22, from Phase2)
```

### **Priority 4: Create Validation Script**

**Track in next compression:**
- Dependency counts
- Equation parameter counts
- Cross-references
- Entry point instructions

---

## üìä **UPDATED SUMMARY**

**Total Documentation:**
- **82+ files**, ~65,000+ lines
- **5 meta-project files** (START_HERE, RULES, README, CURRENT_STATE, AUDIT)
- **46 module docs** (single source of truth)
- **3 notes files** (growing with feedback)
- **6 cross-module analyses**
- **6 GAMS reference guides**
- **5 slash commands**

**Inconsistency Risks:**
- **HIGH**: Module dependencies (5 locations)
- **HIGH**: Conservation laws (4 locations)
- **MEDIUM**: Workflow instructions (5 locations)
- **MEDIUM**: Entry point confusion (4 files)
- **LOW**: Most other content is complementary

**Mitigation Strategy:**
1. ‚úÖ Add document role hierarchy to CLAUDE.md
2. ‚úÖ Create validation script
3. ‚úÖ Use compression to eliminate duplicates
4. ‚úÖ Maintain "link don't duplicate" culture

---

**Thank you for catching this! The meta-project files are critical and I should have included them in the original analysis.**
